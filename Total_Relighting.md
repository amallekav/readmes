# Image Relighting Project

This repository contains all necessary files and scripts for a portrait relighting project. The project uses a deep neural network to relight portraits and seamlessly integrate them with different backgrounds, inspired by the "Total Relighting" framework. The project includes an interactive RGB slider tool that enables user-driven customization of lighting effects, making it flexible for digital content creation and visual effects.

## Directory Structure

The folder structure is as follows:

- **data/**: Contains input images and sample data used for relighting experiments.
  - `input_image.jpg`: Example portrait image.
  - `background_images/`: Sample backgrounds for testing integration with relighted portraits.

- **model/**: Contains model architecture files.
  - `model_architecture.py`: Defines the neural network architecture for portrait relighting.

- **result_1024/**: Stores relighted images generated by the model.
  - `output_image.jpg`: Example relighted portrait saved here after processing.

- **trained_model/**: Contains the pre-trained model weights required for relighting.
  - `trained_model.pth`: Model weights that the script loads to perform relighting.

- **utils/**: Utility scripts required for processing and lighting transformations.
  - `utils_normal.py`: Functions for basic image processing.
  - `utils_SH.py`: Functions to handle spherical harmonics calculations for realistic lighting effects.
  - `utils_shtools.py`: Additional tools supporting spherical harmonics for relighting.

- **testNetwork_demo_1024.py**: Main Python script that manages the relighting process. This script:
  - Loads the input portrait image.
  - Processes it through the model using trained weights.
  - Applies lighting transformations based on spherical harmonics.
  - Saves the relighted output in the `result` folder.

## How to Use

### Prerequisites

1. **Environment Setup**: Make sure you have Python 3, Jupyter Notebook, and the following libraries installed:
   - **PyTorch**: For loading and running the neural network model.
   - **OpenCV**: For image processing.
   - **Matplotlib**: For visualizing images.
   - **NumPy**: For array manipulations.
   - **Tkinter**: For the interactive RGB slider tool (ensure your environment supports GUIs).

   To install these dependencies, run:
   ```bash
   pip install torch opencv-python matplotlib numpy


### Step-by-Step Guide

1. **Upload the `DPR-master` Folder**:
   - Upload the `DPR-master.zip` file to your environment (e.g., Google Colab or a local Jupyter environment).
   - Extract the zip file by running this code in a cell (for Colab or Jupyter Notebook):
     ```python
     import zipfile

     with zipfile.ZipFile('DPR-master.zip', 'r') as zip_ref:
         zip_ref.extractall('DPR-master')
     ```

2. **Open the Notebook**:
   - Open the `total_relighting.ipynb` notebook in Jupyter or Google Colab.

3. **Run Each Cell in Sequence**:
   - Execute each cell in the notebook to complete setup and the relighting process. The main steps include:
     - **Import Libraries**: Loads necessary libraries.
     - **Load Model and Utilities**: Sets up the pre-trained model weights from `trained_model/` and utility functions from `utils/`.
     - **Load Input Image**: Loads the input portrait image from `data/`, preprocessed and prepared for relighting.
     - **Relight the Portrait**: The model applies lighting transformations to the portrait using spherical harmonics, saving the results in the `result` folder.

4. **Use the Interactive RGB Slider Tool**:
   - This interactive tool is essential for refining the relighting output by allowing users to manually adjust lighting properties.
     - **Red Slider**: Adjusts red intensity, adding warmth or reducing it for cooler tones.
     - **Green Slider**: Controls vibrancy and color balance.
     - **Blue Slider**: Modifies cool tones, affecting shadow depth and contrast.
   - Each slider change updates the image instantly, allowing users to create the desired lighting effect through fine-tuning.

5. **View and Save Results**:
   - The final images will be shown in the jupyter notebook and also stored in the `result_1024` folder.
   - You can view the relighted portraits in the notebook or download them for further use.

**Notes**
Input and Expected Outputs: The input images and anticipated outputs are from the "Deep Single Portrait Image Relighting" repository by Zhou et al. (2019). These expected results help validate the accuracy of the model's relighting performance.
Directory Structure: Ensure the directory structure within DPR-master remains unchanged, as the paths in the notebook depend on this setup.





